/**
 * @fileoverview Prevent usage of Session
 * @author Dominik Ferber
 */

'use strict';

var _utilEnvironment = require('../util/environment');

var _util = require('../util');

// -----------------------------------------------------------------------------
// Rule Definition
// -----------------------------------------------------------------------------

module.exports = function (getMeta) {
  return function (context) {
    var _getMeta = getMeta(context);

    var env = _getMeta.env;

    // -------------------------------------------------------------------------
    // Public
    // -------------------------------------------------------------------------

    if (env === _utilEnvironment.NON_METEOR) {
      return {};
    }

    return {
      MemberExpression: function MemberExpression(node) {
        if (node.object.name === 'Session') {

          var executors = (0, _util.getExecutors)(env, context.getAncestors());
          if (!executors.has('browser') && !executors.has('cordova')) {
            return;
          }

          context.report(node, 'Unexpected Session statement');
        }
      }

    };
  };
};

module.exports.schema = [];